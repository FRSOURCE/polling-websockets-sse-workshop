<html>

<head>
  <title>Express</title>
</head>

<body>
  <h1>Express</h1>
  <p>Welcome to Express</p>

  <div class="chat"></div>
  <form id="new-message-form">
    <input type="text" name="message"/>
    <button>submit</button>
  </form>

  <script>
    const chatBox = document.querySelector('.chat');

    const connection = new WebSocket('ws://localhost:3000/messages');

    const updateChatBox = (messages) => {
      let newMessagesListHTML = '';
      messages.forEach(({ created, content }) => {
        newMessagesListHTML += `<p><i>${new Date(created).toLocaleString()}</i>&nbsp; ${content}</p>`;
      });

      chatBox.innerHTML += newMessagesListHTML;
    };

    connection.onmessage = function (message) {
      const messages = JSON.parse(message.data);
      updateChatBox(messages);
    };

    const postMessage = (content) => connection.send(JSON.stringify({ content }));
    
    document.querySelector('#new-message-form').addEventListener('submit', async function (e) {
      e.preventDefault();
      postMessage(this.elements.message.value);
      this.elements.message.value = '';
    });
  </script>
</body>

</html>
